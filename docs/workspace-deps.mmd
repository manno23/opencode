flowchart TB
  subgraph Repo_Root[Repo root]
    direction TB
    Packages["packages/* (upstream)"]
    SDK_JS["packages/sdk/js\n(name: @opencode-ai/sdk)"]
    SDK_TS["sdk/typescript\n(name: @opencode-ai/sdk-next)"]
    App["packages/opencode (app)\ndepends on @opencode-ai/sdk"]
    Other["other packages\n(depends on workspace packages)"]
  end

  %% Workspace links
  SDK_JS -->|workspace link| App
  SDK_JS -->|workspace available| Other

  %% New SDK-next
  SDK_TS -.->|dev link / bun link| App
  SDK_TS -.->|dev link / bun link| Other

  %% Fork strategies
  subgraph Fork_Strategies[Fork strategies]
    direction TB
    KeepNames["Keep upstream package names\n(packages/sdk/js remains @opencode-ai/sdk)"]
    LocalLink["Local link (bun link / npm link)\nRegisters local packages without repo edits"]
    NodeModulesShim["Node_modules shim (symlinks)\nCreate node_modules/@opencode-ai/* -> local paths"]
    Overrides["Overrides / resolutions\nPin transitive deps in root package.json"]
    Alias["Alias / New package name\nUse @opencode-ai/sdk-next and migrate consumers gradually"]
  end

  %% Connections
  KeepNames --> SDK_JS
  LocalLink --> SDK_TS
  LocalLink --> SDK_JS
  NodeModulesShim --> SDK_TS
  NodeModulesShim --> SDK_JS
  Overrides --> App
  Alias --> SDK_TS
  Alias --> App

  %% Notes on migration flow
  MigrationFlow["Migration flow:\n1) Link sdk-next locally\n2) Update consumer imports one file at a time\n3) Use overrides when needed\n4) Revert to upstream by removing links"]
  Fork_Strategies --> MigrationFlow

  classDef pkg fill:#f9f,stroke:#333,stroke-width:1px
  class SDK_JS,SDK_TS,App,Other pkg
